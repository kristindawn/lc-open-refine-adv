---
title: "More Transformations"
teaching: 5
exercises: 15
questions:
- "How can we iteratively use transformations to clean up data?"
- "What happens when we split data into several columns?"
objectives:
- "Learn how to find new expressions in the documentation"
- "Learn how to combine expressions to save time"
keypoints:
- "There are mulitple expressions that you can use to get the same result"
- "Sometimes adding columns can help with sticky data problems"
---

## Writing more transformations
Reminder:
GREL functions are written by giving a value of some kind (a text string, a date, a number etc.) to a GREL function. Some GREL functions take additional parameters or options which control how the function works. 

GREL supports two types of syntax:

* ```value.function(options)```
* ```function(value, options)```

Either is valid, and which is used is completely down to personal preference. In these notes the first syntax is used.

###Two ways to split data 

Ideally, we would only have one piece and one type of information in a cell in a table. As we know, this isn't always the case with data we get from other sources. There are two different ways we can separate data in a cell in OpenRefine:
* Creating new rows in the same column ```Edit cells > Split multi-valued cells...```
* Creating new columns for each piece of data ```Edit columns > Split into several columns...```

>## When would we want new rows versus new columns? 
>
> If each piece of data is in the same category, you will want to create new rows in the same column. Then those values can be compared against each other like we did in the author example.
>
> If the data are in different categories you will want to create new columns. We are going to work with the *Citation* column, which has several kinds of data in one cell. 
>
> Note: These techniques only work if the data is consistently formatted. If there are inconsistencies then splitting the data will create additional problems. 
{: .challenge}

>## Let's look closer at the *Citation* column and determine what we want it to look like. 
>
> 1. How many different kinds of data are in the column?
> 2. How many different separators are there?
> 3. Are the data all formatted the same? Can we assume if we split the data our columns will have the same category of data for each row?
>>## Solution
>>1. There are 5 kinds of data, so we will need at least 5 columns.
>>2. There are 2 obvious separators (*,*, *)*) and 1 that may not have been so obvious (*-*). 
>>3. It looks like it, but it depends on how granular you want to get. There are some discrepancies in how page numbers are represented.
>{: .solution}
{: .challenge}

###Splitting one column into several columns

The citation column can be split into at least 5 columns, but the separators aren't the same for all types of data. This is going to be an iterative process where the order in which we do things is important. The separator to create 4 of the 5 columns is *,*, so we will separate the columns using that first. 

In the *Split into several columns...* you can leave the default values set. 

>## Where might identifying the number of columns be useful?
{: .challenge}

You should have 4 new columns named *Citation 1*, *Citation 2*, *Citation 3*, and *Citation 4*. 

>## Use Clustering to clean up author data
>
>1. Split out the author names into individual cells using `Edit cells -> Split multi-valued cells`, using the pipe ( \| ) character as the separator
>2. Choose `Edit cells -> Cluster and edit` from the 'author' column.
>3. Using the `key collision` method with the `fingerprint` Keying Function, work through the clusters of values, merging them to a single value where appropriate
>4. Try changing the clustering method being used - which ones work well?
{: .challenge}

>## Put titles into Title Case
>Use Facets and the GREL expression ```value.toTitlecase()``` to put the titles in Title Case
>1. Facet by publisher
>2. Select "Akshantala Enterprises" and "Society of Pharmaceutical Technocrats"
>3. To select multiple values in the facet use the ```include``` link that appears to the right of the facet
>4. See that the Titles for these are all in uppercase
>5.  Click the dropdown menu on the Title column
>6. Choose ```Edit cells->Transform...```
>7. In the Expression box type ```value.toTitlecase()```
>8. In the Preview pane under value.toTitlecase() you can see what the effect of running this will be
>9. Click ```OK```
>
>This is an example of using the GREL expression for a process that you can run from the Common Transform list. 
>Where would we need to use the expression instead of choosing it from the list?
{: .checklist}
